{"version":3,"sources":["salvattore.js"],"names":["root","factory","define","amd","exports","module","salvattore","this","window","matchMedia","styleMedia","media","info","style","document","createElement","script","getElementsByTagName","type","id","parentNode","insertBefore","getComputedStyle","currentStyle","matchMedium","text","styleSheet","cssText","textContent","width","matches","addListener","localMatchMedia","hasMediaQueries","isListening","timeoutID","queries","handleChange","evt","clearTimeout","setTimeout","i","il","length","mql","listeners","j","jl","call","index","listener","addEventListener","push","removeListener","splice","lastTime","vendors","x","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","Date","getTime","timeToCall","Math","max","CustomEvent","event","params","bubbles","cancelable","detail","undefined","createEvent","initCustomEvent","prototype","Event","global","self","grids","mediaRules","mediaQueries","add_to_dataset","key","value","dataset","setAttribute","obtainGridSettings","content","getPropertyValue","slice","matchResult","match","numberOfColumns","columnClasses","split","addColumns","grid","items","selector","settings","columnsItems","Array","columnsFragment","createDocumentFragment","querySelectorAll","forEach","rows","column","rowsFragment","className","join","row","appendChild","removeColumns","range","createRange","selectNodeContents","columns","filter","extractContents","childNodes","node","HTMLElement","numberOfRowsInFirstColumn","sortedRows","columnIndex","children","rowIndex","container","child","recreateColumns","columnsChange","dispatchEvent","mediaQueryChange","getCSSRules","stylesheet","cssRules","sheet","rules","e","getStylesheets","inlineStyleBlocks","idx","concat","mediaRuleHasColumnsSelector","rule","selectorText","scanMediaQueries","newMediaRules","oldRules","el","indexOf","mediaText","rescanMediaQueries","nextElementColumnIndex","fragments","currentRowCount","m","lowestRowCount","createFragmentsList","quantity","appendElements","elements","prependElements","fragment","firstChild","numberOfColumnsToExtract","lastChild","registerGrid","display","init","css","innerHTML","head","gridElements","append_elements","prepend_elements","register_grid","recreate_columns","rescan_media_queries"],"mappings":"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","file":"salvattore.min.js","sourcesContent":["/*!\n * Salvattore 1.0.9 by @rnmp and @ppold\n * https://github.com/rnmp/salvattore\n */\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.salvattore = factory();\n  }\n}(this, function() {\n/*! matchMedia() polyfill - Test a CSS media type/query in JS. Authors & copyright (c) 2012: Scott Jehl, Paul Irish, Nicholas Zakas, David Knight. Dual MIT/BSD license */\n\nif (!window.matchMedia) {\n    window.matchMedia = function() {\n        \"use strict\";\n\n        // For browsers that support matchMedium api such as IE 9 and webkit\n        var styleMedia = (window.styleMedia || window.media);\n\n        // For those that don't support matchMedium\n        if (!styleMedia) {\n            var style       = document.createElement('style'),\n                script      = document.getElementsByTagName('script')[0],\n                info        = null;\n\n            style.type  = 'text/css';\n            style.id    = 'matchmediajs-test';\n\n            script.parentNode.insertBefore(style, script);\n\n            // 'style.currentStyle' is used by IE <= 8 and 'window.getComputedStyle' for all other browsers\n            info = ('getComputedStyle' in window) && window.getComputedStyle(style, null) || style.currentStyle;\n\n            styleMedia = {\n                matchMedium: function(media) {\n                    var text = '@media ' + media + '{ #matchmediajs-test { width: 1px; } }';\n\n                    // 'style.styleSheet' is used by IE <= 8 and 'style.textContent' for all other browsers\n                    if (style.styleSheet) {\n                        style.styleSheet.cssText = text;\n                    } else {\n                        style.textContent = text;\n                    }\n\n                    // Test if media query is true or false\n                    return info.width === '1px';\n                }\n            };\n        }\n\n        return function(media) {\n            return {\n                matches: styleMedia.matchMedium(media || 'all'),\n                media: media || 'all'\n            };\n        };\n    }();\n}\n\n/*! matchMedia() polyfill addListener/removeListener extension. Author & copyright (c) 2012: Scott Jehl. Dual MIT/BSD license */\n(function(){\n    \"use strict\";\n\n    // Bail out for browsers that have addListener support\n    if (window.matchMedia && window.matchMedia('all').addListener) {\n        return false;\n    }\n\n    var localMatchMedia = window.matchMedia,\n        hasMediaQueries = localMatchMedia('only all').matches,\n        isListening     = false,\n        timeoutID       = 0,    // setTimeout for debouncing 'handleChange'\n        queries         = [],   // Contains each 'mql' and associated 'listeners' if 'addListener' is used\n        handleChange    = function(evt) {\n            // Debounce\n            clearTimeout(timeoutID);\n\n            timeoutID = setTimeout(function() {\n                for (var i = 0, il = queries.length; i < il; i++) {\n                    var mql         = queries[i].mql,\n                        listeners   = queries[i].listeners || [],\n                        matches     = localMatchMedia(mql.media).matches;\n\n                    // Update mql.matches value and call listeners\n                    // Fire listeners only if transitioning to or from matched state\n                    if (matches !== mql.matches) {\n                        mql.matches = matches;\n\n                        for (var j = 0, jl = listeners.length; j < jl; j++) {\n                            listeners[j].call(window, mql);\n                        }\n                    }\n                }\n            }, 30);\n        };\n\n    window.matchMedia = function(media) {\n        var mql         = localMatchMedia(media),\n            listeners   = [],\n            index       = 0;\n\n        mql.addListener = function(listener) {\n            // Changes would not occur to css media type so return now (Affects IE <= 8)\n            if (!hasMediaQueries) {\n                return;\n            }\n\n            // Set up 'resize' listener for browsers that support CSS3 media queries (Not for IE <= 8)\n            // There should only ever be 1 resize listener running for performance\n            if (!isListening) {\n                isListening = true;\n                window.addEventListener('resize', handleChange, true);\n            }\n\n            // Push object only if it has not been pushed already\n            if (index === 0) {\n                index = queries.push({\n                    mql         : mql,\n                    listeners   : listeners\n                });\n            }\n\n            listeners.push(listener);\n        };\n\n        mql.removeListener = function(listener) {\n            for (var i = 0, il = listeners.length; i < il; i++){\n                if (listeners[i] === listener){\n                    listeners.splice(i, 1);\n                }\n            }\n        };\n\n        return mql;\n    };\n}());\n\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel\n\n// MIT license\n\n(function() {\n    \"use strict\";\n\n    var lastTime = 0;\n    var vendors = ['ms', 'moz', 'webkit', 'o'];\n    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] ||\n            window[vendors[x]+'CancelRequestAnimationFrame'];\n    }\n\n    if (!window.requestAnimationFrame)\n        window.requestAnimationFrame = function(callback, element) {\n            var currTime = new Date().getTime();\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); },\n              timeToCall);\n            lastTime = currTime + timeToCall;\n            return id;\n        };\n\n    if (!window.cancelAnimationFrame)\n        window.cancelAnimationFrame = function(id) {\n            clearTimeout(id);\n        };\n}());\n\n// https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent\n\nif (typeof window.CustomEvent !== \"function\") {\n  (function() {\n    \"use strict\";\n    function CustomEvent(event, params) {\n      params = params || { bubbles: false, cancelable: false, detail: undefined };\n      var evt = document.createEvent('CustomEvent');\n      evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n      return evt;\n     }\n\n    CustomEvent.prototype = window.Event.prototype;\n\n    window.CustomEvent = CustomEvent;\n  })();\n}\n\n/* jshint laxcomma: true */\nvar salvattore = (function (global, document, undefined) {\n\"use strict\";\n\nvar self = {},\n    grids = [],\n    mediaRules = [],\n    mediaQueries = [],\n    add_to_dataset = function(element, key, value) {\n      // uses dataset function or a fallback for <ie10\n      if (element.dataset) {\n        element.dataset[key] = value;\n      } else {\n        element.setAttribute(\"data-\" + key, value);\n      }\n      return;\n    };\n\nself.obtainGridSettings = function obtainGridSettings(element) {\n  // returns the number of columns and the classes a column should have,\n  // from computing the style of the ::before pseudo-element of the grid.\n\n  var computedStyle = global.getComputedStyle(element, \":before\")\n    , content = computedStyle.getPropertyValue(\"content\").slice(1, -1)\n    , matchResult = content.match(/^\\s*(\\d+)(?:\\s?\\.(.+))?\\s*$/)\n    , numberOfColumns = 1\n    , columnClasses = []\n  ;\n\n  if (matchResult) {\n    numberOfColumns = matchResult[1];\n    columnClasses = matchResult[2];\n    columnClasses = columnClasses? columnClasses.split(\".\") : [\"column\"];\n  } else {\n    matchResult = content.match(/^\\s*\\.(.+)\\s+(\\d+)\\s*$/);\n    if (matchResult) {\n      columnClasses = matchResult[1];\n      numberOfColumns = matchResult[2];\n      if (numberOfColumns) {\n            numberOfColumns = numberOfColumns.split(\".\");\n      }\n    }\n  }\n\n  return {\n    numberOfColumns: numberOfColumns,\n    columnClasses: columnClasses\n  };\n};\n\n\nself.addColumns = function addColumns(grid, items) {\n  // from the settings obtained, it creates columns with\n  // the configured classes and adds to them a list of items.\n\n  var settings = self.obtainGridSettings(grid)\n    , numberOfColumns = settings.numberOfColumns\n    , columnClasses = settings.columnClasses\n    , columnsItems = new Array(+numberOfColumns)\n    , columnsFragment = document.createDocumentFragment()\n    , i = numberOfColumns\n    , selector\n  ;\n\n  while (i-- !== 0) {\n    selector = \"[data-columns] > *:nth-child(\" + numberOfColumns + \"n-\" + i + \")\";\n    columnsItems.push(items.querySelectorAll(selector));\n  }\n\n  columnsItems.forEach(function append_to_grid_fragment(rows) {\n    var column = document.createElement(\"div\")\n      , rowsFragment = document.createDocumentFragment()\n    ;\n\n    column.className = columnClasses.join(\" \");\n\n    Array.prototype.forEach.call(rows, function append_to_column(row) {\n      rowsFragment.appendChild(row);\n    });\n    column.appendChild(rowsFragment);\n    columnsFragment.appendChild(column);\n  });\n\n  grid.appendChild(columnsFragment);\n  add_to_dataset(grid, 'columns', numberOfColumns);\n};\n\n\nself.removeColumns = function removeColumns(grid) {\n  // removes all the columns from a grid, and returns a list\n  // of items sorted by the ordering of columns.\n\n  var range = document.createRange();\n  range.selectNodeContents(grid);\n\n  var columns = Array.prototype.filter.call(range.extractContents().childNodes, function filter_elements(node) {\n    return node instanceof global.HTMLElement;\n  });\n\n  var numberOfColumns = columns.length\n    , numberOfRowsInFirstColumn = columns[0].childNodes.length\n    , sortedRows = new Array(numberOfRowsInFirstColumn * numberOfColumns)\n  ;\n\n  Array.prototype.forEach.call(columns, function iterate_columns(column, columnIndex) {\n    Array.prototype.forEach.call(column.children, function iterate_rows(row, rowIndex) {\n      sortedRows[rowIndex * numberOfColumns + columnIndex] = row;\n    });\n  });\n\n  var container = document.createElement(\"div\");\n  add_to_dataset(container, 'columns', 0);\n\n  sortedRows.filter(function filter_non_null(child) {\n    return !!child;\n  }).forEach(function append_row(child) {\n    container.appendChild(child);\n  });\n\n  return container;\n};\n\n\nself.recreateColumns = function recreateColumns(grid) {\n  // removes all the columns from the grid, and adds them again,\n  // it is used when the number of columns change.\n\n  global.requestAnimationFrame(function render_after_css_mediaQueryChange() {\n    self.addColumns(grid, self.removeColumns(grid));\n    var columnsChange = new CustomEvent(\"columnsChange\");\n    grid.dispatchEvent(columnsChange);\n  });\n};\n\n\nself.mediaQueryChange = function mediaQueryChange(mql) {\n  // recreates the columns when a media query matches the current state\n  // of the browser.\n\n  if (mql.matches) {\n    Array.prototype.forEach.call(grids, self.recreateColumns);\n  }\n};\n\n\nself.getCSSRules = function getCSSRules(stylesheet) {\n  // returns a list of css rules from a stylesheet\n\n  var cssRules;\n  try {\n    cssRules = stylesheet.sheet.cssRules || stylesheet.sheet.rules;\n  } catch (e) {\n    return [];\n  }\n\n  return cssRules || [];\n};\n\n\nself.getStylesheets = function getStylesheets() {\n  // returns a list of all the styles in the document (that are accessible).\n\n  var inlineStyleBlocks = Array.prototype.slice.call(document.querySelectorAll(\"style\"));\n  inlineStyleBlocks.forEach(function(stylesheet, idx) {\n    if (stylesheet.type !== 'text/css' && stylesheet.type !== '') {\n      inlineStyleBlocks.splice(idx, 1);\n    }\n  });\n\n  return Array.prototype.concat.call(\n    inlineStyleBlocks,\n    Array.prototype.slice.call(document.querySelectorAll(\"link[rel='stylesheet']\"))\n  );\n};\n\n\nself.mediaRuleHasColumnsSelector = function mediaRuleHasColumnsSelector(rules) {\n  // checks if a media query css rule has in its contents a selector that\n  // styles the grid.\n\n  var i, rule;\n\n  try {\n    i = rules.length;\n  }\n  catch (e) {\n    i = 0;\n  }\n\n  while (i--) {\n    rule = rules[i];\n    if (rule.selectorText && rule.selectorText.match(/\\[data-columns\\](.*)::?before$/)) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\n\nself.scanMediaQueries = function scanMediaQueries() {\n  // scans all the stylesheets for selectors that style grids,\n  // if the matchMedia API is supported.\n\n  var newMediaRules = [];\n\n  if (!global.matchMedia) {\n    return;\n  }\n\n  self.getStylesheets().forEach(function extract_rules(stylesheet) {\n    Array.prototype.forEach.call(self.getCSSRules(stylesheet), function filter_by_column_selector(rule) {\n      // rule.media throws an 'not implemented error' in ie9 for import rules occasionally\n      try {\n        if (rule.media && rule.cssRules && self.mediaRuleHasColumnsSelector(rule.cssRules)) {\n          newMediaRules.push(rule);\n        }\n      } catch (e) {}\n    });\n  });\n\n  // remove matchMedia listeners from the old rules\n  var oldRules = mediaRules.filter(function (el) {\n      return newMediaRules.indexOf(el) === -1;\n  });\n  mediaQueries.filter(function (el) {\n    return oldRules.indexOf(el.rule) !== -1;\n  }).forEach(function (el) {\n      el.mql.removeListener(self.mediaQueryChange);\n  });\n  mediaQueries = mediaQueries.filter(function (el) {\n    return oldRules.indexOf(el.rule) === -1;\n  });\n\n  // add matchMedia listeners to the new rules\n  newMediaRules.filter(function (el) {\n    return mediaRules.indexOf(el) == -1;\n  }).forEach(function (rule) {\n      var mql = global.matchMedia(rule.media.mediaText);\n      mql.addListener(self.mediaQueryChange);\n      mediaQueries.push({rule: rule, mql:mql});\n  });\n\n  // swap mediaRules with the new set\n  mediaRules.length = 0;\n  mediaRules = newMediaRules;\n};\n\n\nself.rescanMediaQueries = function rescanMediaQueries() {\n    self.scanMediaQueries();\n    Array.prototype.forEach.call(grids, self.recreateColumns);\n};\n\n\nself.nextElementColumnIndex = function nextElementColumnIndex(grid, fragments) {\n  // returns the index of the column where the given element must be added.\n\n  var children = grid.children\n    , m = children.length\n    , lowestRowCount = 0\n    , child\n    , currentRowCount\n    , i\n    , index = 0\n  ;\n  for (i = 0; i < m; i++) {\n    child = children[i];\n    currentRowCount = child.children.length + (fragments[i].children || fragments[i].childNodes).length;\n  if(lowestRowCount === 0) {\n    lowestRowCount = currentRowCount;\n  }\n    if(currentRowCount < lowestRowCount) {\n      index = i;\n      lowestRowCount = currentRowCount;\n    }\n  }\n\n  return index;\n};\n\n\nself.createFragmentsList = function createFragmentsList(quantity) {\n  // returns a list of fragments\n\n  var fragments = new Array(quantity)\n    , i = 0\n  ;\n\n  while (i !== quantity) {\n    fragments[i] = document.createDocumentFragment();\n    i++;\n  }\n\n  return fragments;\n};\n\n\nself.appendElements = function appendElements(grid, elements) {\n  // adds a list of elements to the end of a grid\n\n  var columns = grid.children\n    , numberOfColumns = columns.length\n    , fragments = self.createFragmentsList(numberOfColumns)\n  ;\n\n  Array.prototype.forEach.call(elements, function append_to_next_fragment(element) {\n    var columnIndex = self.nextElementColumnIndex(grid, fragments);\n    fragments[columnIndex].appendChild(element);\n  });\n\n  Array.prototype.forEach.call(columns, function insert_column(column, index) {\n    column.appendChild(fragments[index]);\n  });\n};\n\n\nself.prependElements = function prependElements(grid, elements) {\n  // adds a list of elements to the start of a grid\n\n  var columns = grid.children\n    , numberOfColumns = columns.length\n    , fragments = self.createFragmentsList(numberOfColumns)\n    , columnIndex = numberOfColumns - 1\n  ;\n\n  elements.forEach(function append_to_next_fragment(element) {\n    var fragment = fragments[columnIndex];\n    fragment.insertBefore(element, fragment.firstChild);\n    if (columnIndex === 0) {\n      columnIndex = numberOfColumns - 1;\n    } else {\n      columnIndex--;\n    }\n  });\n\n  Array.prototype.forEach.call(columns, function insert_column(column, index) {\n    column.insertBefore(fragments[index], column.firstChild);\n  });\n\n  // populates a fragment with n columns till the right\n  var fragment = document.createDocumentFragment()\n    , numberOfColumnsToExtract = elements.length % numberOfColumns\n  ;\n\n  while (numberOfColumnsToExtract-- !== 0) {\n    fragment.appendChild(grid.lastChild);\n  }\n\n  // adds the fragment to the left\n  grid.insertBefore(fragment, grid.firstChild);\n};\n\n\nself.registerGrid = function registerGrid (grid) {\n  if (global.getComputedStyle(grid).display === \"none\") {\n    return;\n  }\n\n  // retrieve the list of items from the grid itself\n  var range = document.createRange();\n  range.selectNodeContents(grid);\n\n  var items = document.createElement(\"div\");\n  items.appendChild(range.extractContents());\n\n\n  add_to_dataset(items, 'columns', 0);\n  self.addColumns(grid, items);\n  grids.push(grid);\n};\n\n\nself.init = function init() {\n  // adds required CSS rule to hide 'content' based\n  // configuration.\n\n  var css = document.createElement(\"style\");\n  css.innerHTML = \"[data-columns]::before{display:block;visibility:hidden;position:absolute;font-size:1px;}\";\n  document.head.appendChild(css);\n\n  // scans all the grids in the document and generates\n  // columns from their configuration.\n\n  var gridElements = document.querySelectorAll(\"[data-columns]\");\n  Array.prototype.forEach.call(gridElements, self.registerGrid);\n  self.scanMediaQueries();\n};\n\nself.init();\n\nreturn {\n  appendElements: self.appendElements,\n  prependElements: self.prependElements,\n  registerGrid: self.registerGrid,\n  recreateColumns: self.recreateColumns,\n  rescanMediaQueries: self.rescanMediaQueries,\n  init: self.init,\n\n  // maintains backwards compatibility with underscore style method names\n  append_elements: self.appendElements,\n  prepend_elements: self.prependElements,\n  register_grid: self.registerGrid,\n  recreate_columns: self.recreateColumns,\n  rescan_media_queries: self.rescanMediaQueries\n};\n\n})(window, window.document);\n\nreturn salvattore;\n}));\n"]}